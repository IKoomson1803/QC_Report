@model Deluxe.QCReport.Common.Models.QCDetailsVM

<div class="bs-callout bs-callout-warning" style="font-size:12px;">
    <b style="font-size:14px;">QC @Model.QCNumber Details</b>

    <table class="table table-striped table-condensed table-hover" style="margin-top: 20px;">
        <thead>
            <tr>
                <td>QC-Rev #</td>
                <td>QC Operator</td>
                <td>Revised Date</td>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.RevList)
            {
                <tr class='clickable-row' style="cursor:pointer;" data-qcnum="@item.Item1" data-revnum="@item.Item2">
                    <td>@string.Format("{0} - {1}", item.Item1, item.Item2)</td>
                    <td>@item.Item3</td>
                    <td>@item.Item4</td>
                </tr>

            }
        </tbody>
    </table>
    @if (Model.SecurityLevel >= 2)
    {
        <div class="row">
            <div class="col-sm-3 text-left">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-primary" id="btnNEQC">Edit QC</button>
                    <button type="button" class="btn btn-sm btn-danger" id="btnDeletePrompt">Delete</button>
                </div>
            </div>

         </div>
    }
</div>

<!-- Modal -->
<div class="modal fade" id="deletePromptModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-body" style="font-size:14px;font-weight:bold;">

            </div>
            <div class="modal-footer">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-sm btn-danger" id="btnDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function IsQCNumberValid(qcNumber) {
        if (qcNumber == '') {
            return false;
        }
        else if (qcNumber == '0') {
            return false;
        }
        if (qcNumber == 0) {
            return false;
        }

        return true;
    }

    function GetDetailsNav(qcno, rno) {

        $.post('/Home/GetTopNavigation', {
            qcnum: qcno, revnum: rno
        })
            .done(function (data) {

               // $("#divTopSubMenu").html(data);
                //console.log('Audio QC in Sub Menu: ' + $("#TopMenu").find('.lnkQcAudioAndTC').length)
                                
                //if (!$("#TopMenu").find('.lnkQcAudioAndTC').length
                //    && !$("#TopMenu").find('.lnkDPPProgDetails').length
                //    && !$("#TopMenu").find('.lnkBNJRProgDetails').length) {
                //    $("#TopMenu").append(data);
                //}

                //if (!$("#TopSubMenu").find('.lnkQcAudioAndTC').length
                //    && !$("#TopSubMenu").find('.lnkDPPProgDetails').length
                //    && !$("#TopSubMenu").find('.lnkBNJRProgDetails').length) {
                //    $("#TopSubMenu").append(data);
                //}


                if (!$("#TopSubMenu").find('.topsubmenu').length) {
                    $("#TopSubMenu").append(data);
                }
            })
        .fail(function (xdata) {

            Msg.error('Error occured! <b>Status:</b> ' + xdata.status + ' <b>Error Message:</b> ' + xdata.statusText, 5 * 1000);
        });
    };

    $(function () {
        $('.clickable-row').on('click', function () {

           // //$('.cssload-preloader').fadeIn();
            var wono = '@Model.WONumber';
            var qcno = $(this).data('qcnum');
            var rno = $(this).data('revnum');

            setQCAndRevNumbers(qcno, rno);

            var isQCNoValid = IsQCNumberValid(qcno)

            if (!isQCNoValid) {
                $('.cssload-preloader').hide();
                return;
            }

            GetDetailsNav(qcno, rno);

            $.post('/Home/RevDetails', { wonum: wono, qcnum: qcno, revnum: rno }).done(function (data) {

                $("#divContent").html(data);
            })
            .fail(function (xdata) {

                Msg.error('Error occured! <b>Status:</b> ' + xdata.status + ' <b>Error Message:</b> ' + xdata.statusText, 5 * 1000);
            })
            .always(function () {

                $('.cssload-preloader').hide();
            });
        });


        $('#btnNEQC').on('click', function () {

            var newQC = {
                qcWONo: '@Model.WONumber',
                qcNo: '@Model.QCNumber',
                qcRev: 1
            };

            $('#modalNE').load("/Home/NewEditQCReport", newQC, function () {

                var bodyBackGround = $("#body-element").css("background-color");

               

                if (bodyBackGround == 'rgb(42, 42, 42)') {
                    $('.modal-content').css('background-color', '#2a2a2a')
                }
                else {
                    // $('.modal-content').css('background-color', '#CDCDD5')
                }


                $('#newQCReportModal').modal('show');

            });

        });

        $('#deletePromptModal').on('shown.bs.modal', function () {

            var qcNum = '@Model.QCNumber';
            var modal = $(this);
            modal.find('.modal-body').text('Are you sure you want to delete QC ' + qcNum + ' and all Revisions therein?');

        });

        $('#btnDeletePrompt').on("click", function () {

            $('#deletePromptModal').modal('show');

        });

        $('#btnDelete').on("click", function () {

            $('#deletePromptModal').modal('hide');

            //$('.cssload-preloader').fadeIn();
            var qcno = '@Model.QCNumber';

            $.post('/Home/DeleteQC', { qcnum: qcno }).done(function (data) {

                if (data.success == true) {
                    Msg.success(data.msg, 5 * 1000);

                    $('#SearchWONumber').val('@Model.WONumber');

                    //$('.cssload-preloader').fadeIn();
                    $('#form_search').submit();
                }
                else {
                    Msg.error(data.msg, 5 * 1000);
                }
            })
            .fail(function (xdata) {

                Msg.error('Error occured! <b>Status:</b> ' + xdata.status + ' <b>Error Message:</b> ' + xdata.statusText, 5 * 1000);
            })
            .always(function () {

                $('.cssload-preloader').hide();
            });
        });
    });
</script>