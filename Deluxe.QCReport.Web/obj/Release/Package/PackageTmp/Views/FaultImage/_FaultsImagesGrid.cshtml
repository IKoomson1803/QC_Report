@model Deluxe.QCReport.Web.Models.HomeVM
@using Deluxe.QCReport.Common.Utilities;

@{
    ViewBag.Title = "Fault Images";
    var list = Model.FaultDescriptionImages.ToList();
    var count = Model.FaultDescriptionImages.Count;
    var itemNo = 0;
   // var imagesLocation = ConfigManager.WebsiteUrl + "/UploadedImages/";
}

@if (list != null && list.Any())
{

    <div id="divFaultsImages" class="col-sm-12 display bs-callout bs-callout-success">

        <div style="padding-bottom:3px;">
            <div id="divCounter" class="btn btn-primary btn-DefaultCursor">
                Total Items
                <span class="badge"> @count</span>
            </div>
        </div>



        <table id="tblFaultsImages" class="table table-striped table-condensed" style="table-layout: fixed;word-wrap: break-word;">
            <thead>
                <tr class="SearchGridHeaderRow">
                    <th class="tblHeaderCell tblHeaderNumberCell">Item No.</th>
                    <th class="tblHeaderCell" width="60%">Description</th>
                    <th class="tblHeaderCell" width="5%">Image</th>
                    <th class="tblHeaderCell" width="25%">Name</th>
                    <th class="tblHeaderCell" width="5%">Action</th>

                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < list.Count; i++)
                {
                    itemNo++;

                    //var imagePath = imagesLocation + list[i].ImageName;

                <tr class='clickable-row' >
                    <td class='clickable-cell' style="cursor:pointer;" data-id="@list[i].Id">@itemNo</td>
                    <td class='clickable-cell' style="cursor:pointer;" data-id="@list[i].Id">
                        @Html.DisplayFor(m => m.FaultDescriptionImages[i].Description)
                    </td>
                    <td>
                      
                        <a href="#" target="_blank" onclick="resetForm('@list[i].ImagePath')">
                            <img width="60" src="@list[i].ImagePath" />
                        </a>
                    </td>
                    <td>
                       
                        <a href="#" target="_blank" onclick="resetForm('@list[i].ImagePath')">
                            @list[i].ImageName
                        </a>
                    </td>
                    <td>
                        &nbsp;&nbsp;  <span onclick="populateFaultDescriptionForm(@list[i].Id)" class="glyphicon glyphicon-edit" style="display:none; color:blue;cursor:pointer;font-size:16px" title="Update Fault Description"></span>
                        &nbsp;&nbsp;  <span id="btnDeletePrompt" onclick="deletePrompt(@list[i].Id,'@list[i].ImageName')" data-id="@list[i].Id" data-imageName="@list[i].ImageName" class="glyphicon glyphicon-remove-circle CRUDButton" style="color:red;cursor:pointer;font-size:16px" title="Delete Fault Description"></span>
                    </td>
                </tr>
                }

            </tbody>
        </table>

    </div>

    <script src="~/Scripts/custom/FaultImagesDataTable.js?v=@DateTime.Now.ToString("yyyyMMddHHmmss")"></script>

    <script type="text/javascript">

        function resetForm(imagePath) {
            $('#FaultDescriptionImage_Id').val('');
            $('#FaultDescriptionImage_Description').val('');
            $('#FaultDescriptionImage_ImageName').val('');
            $('#spImageName').html('');
            $('#btnSave').html('Save');
            $("a").attr("href", imagePath)
            return false;
        }

        //clickable-cell
        //$( this ).parent()

        $('.clickable-cell').on('click', function () {
           
            $('table tr').removeClass("selectedRow");
            $(this).parent().addClass("selectedRow");
            var id = $(this).data('id');
            populateFaultDescriptionForm(id);
        });

        function populateFaultDescriptionForm(id) {

            $.ajax({
                url: '/FaultImage/GetFaultDetails',
                async: true,
                data: { id: id },
                type: 'Get',
                success: function (result) {

                    if (result.Id > 0) {
                        showFaultDescriptionForm(result);
                    }
                    else {

                    }
                }
            });
        }

        function showFaultDescriptionForm(result) {

          //alert('Image Name: ' + result.ImageName)

            $('#FaultDescriptionImage_Id').val(result.Id);
            $('#FaultDescriptionImage_Description').val(result.Description);
            $('#FaultDescriptionImage_ImageName').val(result.ImageName);
            $('#spImageName').html(result.ImageName);
            $('#btnSave').html('Update');
        }


        function deletePrompt(id, imageName) {
            //alert(id);
            //alert(imageName);

            $('#FaultDescriptionImage_Id').val(id);
            $('#FaultDescriptionImage_ImageName').val(imageName);
            $('#deletePromptModal').modal('show');
        }


        //$('#btnDeletePrompt').on("click", function () {
        //    alert('delete')
        //    $('#FaultDescriptionImage_Id').val($(this).data('id'));
        //    $('#FaultDescriptionImage_ImageName').val($(this).data('imageName'));
        //    $('#deletePromptModal').modal('show');

        //});

        $('#deletePromptModal').on('shown.bs.modal', function () {

           var imageName = $('#FaultDescriptionImage_ImageName').val();
           var modal = $(this);
           modal.find('.modal-body').text('Are you sure you want to delete fault image "' + imageName + '"?');

        });

         $('#btnDelete').on("click", function () {

             $('#deletePromptModal').modal('hide');

             var id = $('#FaultDescriptionImage_Id').val();

             $.ajax({
                 url: '/FaultImage/DeleteFaultDetails',
                 type: "POST",
                 async: true,
                 data: { id: id },
                 success: function (result) {
                     //alert(result)
                       $("#divContent").html(result); 
                       $(".subMenuOnClick").removeClass("subMenuOnClick")
                       $("#btnFaultImage").addClass("subMenuOnClick");
                       $('#FaultDescriptionImage_Id').val('0');
                       $('#FaultDescriptionImage_Description').val('');
                       $('#FaultDescriptionImage_ImageName').val('');
                       $('#spImageName').html('');
                       $('#divMessage').html('');
                     
                       $('#deletePromptModal').modal('hide');
                       $('body').removeClass('modal-open');
                       $('.modal-backdrop').remove();
                 },
                 error: function (err) {

                     alert(err.statusText);
                 }
             });

       });

    </script>


    <!-- Modal -->
    <div class="modal fade" id="deletePromptModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body" style="font-size:14px;font-weight:bold;">

                </div>
                <div class="modal-footer">
                    <div>
                        <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-sm btn-danger" id="btnDelete">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


}

